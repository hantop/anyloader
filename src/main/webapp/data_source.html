<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <title>数据源管理</title>

    <link href="css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="js/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" type="text/css">

    <link href="css/style.css?v=2.2.0" rel="stylesheet">
    
    

</head>

<body>
    <div id="wrapper">
        
        <div id= "left"></div>

        <div id="page-wrapper" class="gray-bg dashbard-1">
        
           <div id ="rightup"></div>
            
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>数据源管理</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">主页</a>
                        </li>
                        <li>
                            <a>元数据管理</a>
                        </li>
                        <li>
                            <strong>数据源管理</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">
                </div>
            </div>
            
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <button type="button" class="btn btn-primary" onclick="add();">添加</button>
                                
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>

                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">

 			<table id="dtb" data-toggle="table" data-url="datasource/list"
			class="table table-hover" data-show-columns="true" data-search="true"
			data-show-refresh="true" data-show-toggle="true"
			data-show-export="true"
			data-side-pagination="server"
			data-pagination="true" data-page-list="[5, 10, 20, 50, 100, 200]"
			data-query-params="queryParams">
			<thead>
				<tr>
					<th data-field="id" data-formatter="hideIdFormatter" class="hide"></th>
					<th data-field="sourceName" data-align="left">数据源名称</th>
					<th data-field="ip" data-align="left">IP</th>
					<th data-field="port" data-align="left">端口</th>
					<th data-field="userName" data-align="left">用户名</th>
					<th data-field="password" data-align="left">密码</th>
					<th data-field="dbType" data-align="left">数据源类型</th>
					<th data-field="remarks" data-align="left">备注</th>
					
					<th data-field="operate" data-formatter="operateFormatter" data-events="operateEvents">操作</th>
				</tr>
			</thead>
		</table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="edituc"  aria-hidden="true" >
			<div class="modal-dialog" style="width:50%;height:70%;">
            <div class="modal-content">
            <form  id="commentForm">
            	<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h3 class="modal-title" id="myModalLabel">编辑</h4>
					</div>
					
                <div class="modal-body">
                    <div class="row">
                        
                                <div class="form-group">
                                <input id="dbsourceId" type="hidden" />
                                    <label class="col-sm-2 control-label">数据源名称</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control"  id="sourceName" name="sourceName">
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">IP</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="ip" name="ip">
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">端口</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="port" name="port">
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">用户名</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="userName" name="userName">
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">密码</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="password" name="password">
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">数据源类型</label>
                                        <div class="col-sm-10">
                                            <select class="form-control m-b" name="dbType" id="dbType">
                                            <option value="1" selected="selected">MYSQL</option>
                                            <option value="2">MONGO</option>
                                        	</select>
                                        </div>
                                </div>
                                
                                <div class="form-group">
                                   <label class="col-sm-2 control-label">描述</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="remarks">
                                        </div>
                                </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" onclick="save();" >保存</button>
					</div>
					</form>
                </div>
            </div>
        	</div>
            
            <div id ="footer"></div>
		</div>

        </div>


    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js?v=3.4.0"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>


    <!-- Data Tables -->
    <script src="js/plugins/bootstrap-table/bootstrap-table.js"></script>
    <script src="js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>

    
    <!-- jQuery Validation plugin javascript-->
    <script type="text/javascript" src="dist/js/bootstrapValidator.js"></script> 
    
    <!-- Custom and plugin javascript -->
    <!-- <script src="js/hplus.js?v=2.2.0"></script>
    <script src="js/plugins/pace/pace.min.js"></script> -->
    
    
    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function () {
            $("#left").load("left.html");
            $("#rightup").load("rightup.html");
            $("#footer").load("footer.html");
            
            $('#commentForm').bootstrapValidator({
              message: 'This value is not valid',
              feedbackIcons: {
                  valid: 'glyphicon glyphicon-ok',
                  invalid: 'glyphicon glyphicon-remove',
                  validating: 'glyphicon glyphicon-refresh'
              },
              fields: {
            	  sourceName: {
                      validators: {
                          notEmpty: {
                              message: '数据源名称不能为空'
                          }
                      }
                  },
                  ip: {
                      validators: {
                          notEmpty: {
                              message: 'IP不能为空'
                          }
                      }
                  },
                  port: {
                      validators: {
                          notEmpty: {
                              message: '端口不能为空'
                          }
                      }
                  },
                  dbType: {
                      validators: {
                          notEmpty: {
                              message: '数据源类型不能为空'
                          }
                      }
                  }
              }
          });

        });
        
        

        function queryParams(params) {
            return params;
        }
        
        function operateFormatter(value, row, index) {
	        return [
	            '<a class="edit ml10" style="color:black;" href="javascript:void(0)" title="编辑">',
	                '<span class="glyphicon glyphicon-edit"></span>',
	            '</a>&emsp;',
	            '<a class="remove ml10" style="color:black;" href="javascript:void(0)" title="删除">',
	                '<i class="glyphicon glyphicon-trash"></i>',
	            '</a>'
	        ].join('');
	    }
        
        function hideIdFormatter(value, row, index) {
	        return "<input type='hidden' value="+value+" name='id' />";
	    }
        
	    function refreshTable(){
	    	$("table").bootstrapTable('refresh', {
                url:$("table").attr('data-url')
            });
	    }
	    
        window.operateEvents = {
    	        'click .like': function (e, value, row, index) {
    	            alert('You click like icon, row: ' + JSON.stringify(row));
    	            console.log(value, row, index);
    	        },
    	        'click .edit': function (e, value, row, index) {
    	        	var id=$("[data-index="+index+"]").find('td').eq(0).children().first().val();
    	            
    	     	   	$("#myModalLabel").html('编辑');
    	        	$.post('datasource/getDataSourceById',{"id":id},function(data){
	            		$("#dbsourceId").val(data.id);
	            		$("#sourceName").val(data.sourceName);
	    	     	    $("#ip").val(data.ip);
	    	     	   	$("#port").val(data.port);
	            		$("#userName").val(data.userName);
	    	     	    $("#password").val(data.password);
	    	     	   	$("#remarks").val(data.remarks);
	    	     	   	$("#dbType option[value='"+data.dbType+"']").attr("selected", true);
		            });
    	        	$("#edituc").modal("show");
    	            //console.log(value, row, index);
    	        },
    	        'click .remove': function (e, value, row, index) {
    	            //alert('You click remove icon, row: ' + JSON.stringify(row));
    	            var delid=$("[data-index="+index+"]").find('td').eq(0).children().first().val();
    	            if(confirm("确定删除该条记录吗？"+delid)){
    	            	$.getJSON('datasource/delete',{"id":delid},function(data){
    	            		refreshTable();
    		            });	
    	            }
    	            //console.log(value, row, index);
    	        }
    	    };
        
        function save(){
        	var bootstrapValidator = $("#commentForm").data('bootstrapValidator');
   			bootstrapValidator.validate();
   			if(bootstrapValidator.isValid())
   			{
	            $.post('datasource/save',{"dbsourceId":$("#dbsourceId").val(),"sourceName":$("#sourceName").val(),"ip":$("#ip").val(),
	            	"port":$("#port").val(),"userName":$("#userName").val(),"password":$("#password").val(),"remarks":$("#remarks").val(),"dbType":$("#dbType").val(),},function(result){
	            		
	            		if (result.status == 'success') 
	            		{
	            			alert('保存成功!');
	            			$("#edituc").modal('hide');
	                      	refreshTable();	
	            		}
	            		else
	            		{
	            			alert(result.message);
	            		}
	     	   }, 'json');
   			}
        }
        
        function add(){
            $("#dbsourceId").val('');
        	$("#sourceName").val('');
     	    $("#ip").val('');
     	   	$("#port").val('');
       		$("#userName").val('');
    	    $("#password").val('');
    	    $("#remarks").val('');
     	   	$("#myModalLabel").html('添加');
        	$("#edituc").modal("show");
        }

    
    </script>


</body>

</html>
